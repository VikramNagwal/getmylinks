generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              Int       @id @default(autoincrement())
  username        String    @unique
  name            String?
  email           String    @unique
  password        String
  bio             String?
  urls            Url[]    
  isVerified      Boolean   @default(false)
  emailVerifiedAt DateTime?
  verificationUid String?   @unique
  refreshToken    String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@map("users")
  @@index([isVerified])
  @@index([id])
}

model Url {
  id          Int         @id @default(autoincrement())
  shortUrl    String      @unique
  longUrl     String
  totalViews  Int         @default(0)
  isActive    Boolean     @default(true)
  createdById Int
  createdBy   User?       @relation(fields: [createdById], references: [id], onDelete: Cascade)
  createdAt   DateTime    @default(now())
  expiresAt   DateTime?
  updatedAt   DateTime    @updatedAt
  clickEvents Analytics[]

  @@index([createdById])
  @@index([isActive])
  @@map("urls")
}

model Analytics {
  id          Int      @id @default(autoincrement())
  urlId       Int
  url         Url     @relation(fields: [urlId], references: [id], onDelete: Cascade)
  clickedAt   DateTime @default(now())
  userAgent   String?
  ipAddress   String?
  referer     String?
  countryCode String?  @db.VarChar(2)
  deviceType  String?  @db.VarChar(20)
  browser     String?  @db.VarChar(50)
  os          String?  @db.VarChar(50)

  @@index([urlId])
  @@map("analytics")
}
